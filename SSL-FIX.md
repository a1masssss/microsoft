# üîê –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SSL

## –ü—Ä–æ–±–ª–µ–º–∞
Let's Encrypt –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ `.well-known/acme-challenge/` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–º–µ–Ω–∞.

## –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd ~/microsoft
chmod +x fix-ssl.sh
./fix-ssl.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
1. ‚úÖ –°–æ–∑–¥–∞—Å—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç ACME endpoint
4. ‚úÖ –ü–æ–ª—É—á–∏—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
5. ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç –Ω–∞ HTTPS
6. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç HTTPS

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è certbot
mkdir -p web/certbot/www
chmod -R 755 web/certbot

# 2. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
docker compose exec web nginx -s reload

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ ACME endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç
curl -I http://mythicai.me/.well-known/acme-challenge/test

# 4. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã)
docker compose run --rm certbot delete --cert-name mythicai.me

# 5. –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
docker compose run --rm certbot certonly \
    --webroot \
    --webroot-path=/var/www/certbot \
    --email admin@mythicai.me \
    --agree-tos \
    --no-eff-email \
    --non-interactive \
    -d mythicai.me \
    -d www.mythicai.me

# 6. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cp web/nginx-ssl.conf web/nginx.conf

# 7. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å nginx
docker compose restart web
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTTP —Ä–µ–¥–∏—Ä–µ–∫—Ç
curl -I http://mythicai.me
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: 301 Moved Permanently

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTTPS
curl -I https://mythicai.me
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: 200 OK

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
docker compose exec web ls -la /etc/letsencrypt/live/mythicai.me/
```

## –û—Ç–ª–∞–¥–∫–∞

–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å DNS:**
   ```bash
   dig mythicai.me
   # –î–æ–ª–∂–µ–Ω —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—Ç—ã:**
   ```bash
   netstat -tuln | grep -E ':(80|443)'
   # –ü–æ—Ä—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ nginx:**
   ```bash
   docker compose logs web | tail -50
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ certbot:**
   ```bash
   docker compose logs certbot | tail -50
   ```

5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å ACME endpoint:**
   ```bash
   # –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
   echo "test" > web/certbot/www/test.txt
   
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
   curl http://mythicai.me/.well-known/acme-challenge/test.txt
   # –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: test
   ```

6. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
   ```bash
   docker compose exec web nginx -t
   ```

## –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

- ‚úÖ ACME challenge location **–î–û–õ–ñ–ï–ù** –±—ã—Ç—å –ø–µ—Ä–≤—ã–º –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx
- ‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `/var/www/certbot` –¥–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –∏ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ–π
- ‚úÖ –ü–æ—Ä—Ç—ã 80 –∏ 443 –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã –≤ firewall
- ‚úÖ DNS –¥–æ–ª–∂–µ–Ω —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π IP —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ Nginx –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

